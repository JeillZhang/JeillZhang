<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>React 事件响应及单组件状态处理 - jblogs</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="jblogs"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="jblogs"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="React 处理与用户交互的逻辑，及单个组件的 State 的管理"><meta property="og:type" content="blog"><meta property="og:title" content="React 事件响应及单组件状态处理"><meta property="og:url" content="https://jblogs.tech/2024/03/framworks/front_framworks/react/event-response-and-single-comp-state/"><meta property="og:site_name" content="jblogs"><meta property="og:description" content="React 处理与用户交互的逻辑，及单个组件的 State 的管理"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://jblogs.tech/images/covers/react/react-logo.jpg"><meta property="article:published_time" content="2024-03-03T03:20:17.000Z"><meta property="article:modified_time" content="2024-03-17T12:26:59.868Z"><meta property="article:author" content="Jeill"><meta property="article:tag" content="笔记"><meta property="article:tag" content="React"><meta property="article:tag" content="前端"><meta property="article:tag" content="框架"><meta property="article:tag" content="前端框架"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://jblogs.tech/images/covers/react/react-logo.jpg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://jblogs.tech/2024/03/framworks/front_framworks/react/event-response-and-single-comp-state/"},"headline":"React 事件响应及单组件状态处理","image":["https://jblogs.tech/images/covers/react/react-logo.jpg"],"datePublished":"2024-03-03T03:20:17.000Z","dateModified":"2024-03-17T12:26:59.868Z","author":{"@type":"Person","name":"Jeill"},"publisher":{"@type":"Organization","name":"jblogs","logo":{"@type":"ImageObject","url":"https://jblogs.tech/img/header.jpg"}},"description":"React 处理与用户交互的逻辑，及单个组件的 State 的管理"}</script><link rel="canonical" href="https://jblogs.tech/2024/03/framworks/front_framworks/react/event-response-and-single-comp-state/"><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.1.1"></head><body class="is-3-column"><nav class="navbar navbar-main is-sticky"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/header.jpg" alt="jblogs" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">主页</a><a class="navbar-item" href="/archives">归档</a><a class="navbar-item" href="/categories">分类</a><a class="navbar-item" href="/tags">标签</a></div><div class="navbar-end"><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-7-widescreen"><div class="card"><div class="card-image"><span class="image is-7by3"><img class="fill" src="/images/covers/react/react-logo.jpg" alt="React 事件响应及单组件状态处理"></span></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2024-03-03T03:20:17.000Z" title="2024/3/3 11:20:17">2024-03-03</time>发表</span><span class="level-item"><time dateTime="2024-03-17T12:26:59.868Z" title="2024/3/17 20:26:59">2024-03-17</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E6%A1%86%E6%9E%B6/">框架</a><span> / </span><a class="link-muted" href="/categories/%E6%A1%86%E6%9E%B6/%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6/">前端框架</a><span> / </span><a class="link-muted" href="/categories/%E6%A1%86%E6%9E%B6/%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6/React/">React</a></span><span class="level-item">26 分钟读完 (大约3858个字)</span></div></div><h1 class="title is-3 is-size-4-mobile">React 事件响应及单组件状态处理</h1><div class="content"><!-- toc -->

<h2 id="事件响应"><a href="#事件响应" class="headerlink" title="事件响应"></a>事件响应</h2><h3 id="事件处理函数"><a href="#事件处理函数" class="headerlink" title="事件处理函数"></a>事件处理函数</h3><blockquote>
<p>使用 <code>React</code> 可以在 JSX 中添加 <strong>事件处理函数</strong>。其中事件处理函数为自定义函数，它将在响应交互（如点击、悬停、表单输入框获得焦点等）时触发。</p>
<p><strong>React 官方文档</strong> – <a target="_blank" rel="noopener" href="https://react.docschina.org/learn/responding-to-events">响应事件</a></p>
</blockquote>
<p>大多元素均可绑定响应的事件，以按钮为例，最常使用的事件为点击事件。在 <code>Ract</code> 中为一个按钮添加点击事件非常简单，只需要在组件内创建一个事件处理函数，并在标签返回时，将其绑定到 <code>onClick</code> 属性上即可：</p>
<figure class="highlight javascript"><figcaption><span>为按钮绑定点击事件</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleButtonClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">&quot;Button clicked.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;handleButtonClick&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      Click me</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br></pre></td></tr></table></figure>

<p>事件处理函数通常有如下特点：</p>
<ul>
<li>通常在 <strong>组件内部</strong> 定义。（这样做的好处是可以直接访问组件内部的 <code>props</code> 。）</li>
<li>名称以 <code>handle</code> 开头，后跟事件名称。（这只是一种惯例，并非强制。）</li>
</ul>
<p>一种更为简洁的方式为使用 <code>Javascript</code> 的箭头函数，为一个元素内联绑定事件处理函数，这种方式当处理函数比较小的情况下是非常方便的：</p>
<figure class="highlight javascript"><figcaption><span>内联函数绑定事件处理</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span>=&gt;</span>&#123;</span></span><br><span class="line"><span class="language-xml">      alert(&quot;Button clicked.&quot;);</span></span><br><span class="line"><span class="language-xml">    &#125;&#125;&gt;</span></span><br><span class="line"><span class="language-xml">	  Click me</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br></pre></td></tr></table></figure>

<h3 id="通过-props-传递事件处理函数"><a href="#通过-props-传递事件处理函数" class="headerlink" title="通过 props 传递事件处理函数"></a>通过 <code>props</code> 传递事件处理函数</h3><p>通常，会在父组件中定义子组件的事件处理函数，这样做提高了子组件的可重用性。例如官网如下示例，根据需要，将不通的事件处理函数传递给按钮组件后，可以实现文件上传、电影点播等不同功能，但是子组件 <code>Button</code> 内部编码却不需要做任何改变。</p>
<figure class="highlight javascript"><figcaption><span>传递事件处理函数给子组件</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// 定义公共组件，其点击事件在使用时传入</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Button</span>(<span class="params">&#123; onClick, children &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;onClick&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;children&#125; // 子组件接收标签内容</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">PlayButton</span>(<span class="params">&#123; movieName &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handlePlayClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">`正在播放 <span class="subst">$&#123;movieName&#125;</span>！`</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Button</span> <span class="attr">onClick</span>=<span class="string">&#123;handlePlayClick&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      播放 &quot;&#123;movieName&#125;&quot;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">UploadButton</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> alert(&#x27;正在上传！&#x27;)&#125;&gt;</span></span><br><span class="line"><span class="language-xml">      上传图片</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Toolbar</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">PlayButton</span> <span class="attr">movieName</span>=<span class="string">&quot;迪迦奥特曼&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">UploadButton</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="事件传播行为"><a href="#事件传播行为" class="headerlink" title="事件传播行为"></a>事件传播行为</h3><p>事件处理函数还会捕获任何来自子组件的事件，即事件从发生的地方开始，沿着 <code>UI</code> 树向上传播。例如：</p>
<figure class="highlight javascript"><figcaption><span>子组件事件传播行为</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Toolbar</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;Toolbar&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">      alert(&#x27;你点击了 toolbar ！&#x27;);</span></span><br><span class="line"><span class="language-xml">    &#125;&#125;&gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> alert(&#x27;正在播放！&#x27;)&#125;&gt;</span></span><br><span class="line"><span class="language-xml">        播放电影</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上述实例中，<code>div</code> 及其子组件 <code>button</code> 均添加了点击事件，虽然行为不同，但是当点击按钮出发其事件处理后，对应的点击事件会沿着UI树向上传播至 <code>div</code> 中，进而触发 <code>div</code> 的点击事件回调其处理函数。所以会看到两次弹窗。<br>但是，这种传播是可以被中断的。每个事件处理函数接收一个 <strong>事件对象</strong> 作为唯一的参数，可以使用此对象来读取有关事件的信息。同样的，若想阻止事件向上传播，可以在子组件事件处理函数的开始处，借助事件的 <code>e.stopPropagation()</code> 方法实现。（浏览器内置组件可以通过自定义组件来包装一下。）</p>
<figure class="highlight javascript"><figcaption><span>阻止子组件事件传播行为</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Button</span>(<span class="params">&#123; onClick, children &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;e</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">      e.stopPropagation(); // 阻止事件传播至父组件</span></span><br><span class="line"><span class="language-xml">      onClick();</span></span><br><span class="line"><span class="language-xml">    &#125;&#125;&gt;</span></span><br><span class="line"><span class="language-xml">      &#123;children&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="阻止组件默认行为"><a href="#阻止组件默认行为" class="headerlink" title="阻止组件默认行为"></a>阻止组件默认行为</h3><p>某些浏览器事件具有与事件相关联的默认行为。例如，点击 <code>&lt;form&gt;</code> 表单内部的按钮会触发表单提交事件，默认情况下将重新加载整个页面，但是这种行为也是可以事件对象的 <code>e.preventDefault()</code> 方法来阻止的：</p>
<figure class="highlight javascript"><figcaption><span>阻止组件的默认行为</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Signup</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">form</span> <span class="attr">onSubmit</span>=<span class="string">&#123;e</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">      e.preventDefault(); // 阻止组件的默认行为</span></span><br><span class="line"><span class="language-xml">      alert(&#x27;提交表单！&#x27;);</span></span><br><span class="line"><span class="language-xml">    &#125;&#125;&gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span>&gt;</span>发送<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="State"><a href="#State" class="headerlink" title="State"></a>State</h2><p>事件处理函数是执行副作用的最佳位置。同渲染函数不同，事件处理函数不需要是 <strong>纯函数</strong>，因此它是用来更改某些值的绝佳位置。例如，更改输入框的值以响应键入，或者更改列表以响应按钮的触发。但是，在修改数据前，通常需要记住修改的值，这在 <code>React</code> 中便是通过 <code>State</code> （状态）来实现的。<br>通常情况下，在组件内部使用普通变量保存状态数据后，在事件（例如按钮的点击事件）处理过程中改变其数据后，无法实现新内容的渲染，这是因为：</p>
<ul>
<li><strong>局部变量无法在多次渲染中持久保存。</strong> 当 <code>React</code> 再次渲染组件时，会从头开始渲染，不会考虑之前对局部变量的任何更改。</li>
<li><strong>更改局部变量不会触发渲染。</strong> <code>React</code> 没有意识到它需要使用新数据再次渲染组件。</li>
</ul>
<p>在 <code>React</code> 中，以上功能可以通过 <code>Hook</code> 函数 <code>useState</code> 实现，该函数接收1个参数，为状态的初始值；返回值可以解构为两个值：其中第一个取值为 <strong>状态</strong> ，第二个值为 <code>setter</code> 函数，用于改变状态的取值，进而触发 <code>React</code> 重新渲染组件。</p>
<p>当编写一个存有 <code>state</code> 的组件时，需要考虑使用多少个 <code>state</code> 变量以及它们都是怎样的数据格式。尽管选择次优的 <code>state</code> 结构下也可以编写正确的程序，但有几个原则可以帮助做出更好的决策：</p>
<ol>
<li><strong>合并关联的 state</strong>。如果总是同时更新两个或更多的 <code>state</code> 变量，可以考虑将它们合并为一个单独的 <code>state</code> 变量。</li>
<li><strong>避免互相矛盾的 state</strong>。当 <code>state</code> 结构中存在多个相互矛盾或“不一致”的 <code>state</code> 时，就可能为此会留下隐患。应尽量避免这种情况。</li>
<li><strong>避免冗余的 state</strong>。如果能在渲染期间从组件的 <code>props</code> 或其现有的 <code>state</code> 变量中计算出一些信息，则不应将这些信息放入该组件的 <code>state</code> 中。</li>
<li><strong>避免重复的 state</strong>。当同一数据在多个 <code>state</code> 变量之间或在多个嵌套对象中重复时，这会很难保持它们同步。应尽可能减少重复。</li>
<li><strong>避免深度嵌套的 state</strong>。深度分层的 <code>state</code> 更新起来不是很方便。如果可能的话，最好以扁平化方式构建 <code>state</code>。</li>
</ol>
<h3 id="添加一个-state-变量"><a href="#添加一个-state-变量" class="headerlink" title="添加一个 state 变量"></a>添加一个 state 变量</h3><p>要添加 <code>state</code> 变量，先从文件顶部的 <code>React</code> 中导入 <code>useState</code>：</p>
<figure class="highlight javascript"><figcaption><span>导入 useState Hook</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>然后接收 Hook 返回的两个值，这两个取值是相互对应的：</p>
<figure class="highlight javascript"><figcaption><span>解构 useState 的返回值</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [state, setXxx] = <span class="title function_">useState</span>(inieState);</span><br></pre></td></tr></table></figure>

<p>官网提供的完整实例如下：</p>
<figure class="highlight javascript"><figcaption><span>官方示例</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; sculptureList &#125; <span class="keyword">from</span> <span class="string">&#x27;./data.js&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Gallery</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [index, setIndex] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">	<span class="comment">// React 会记住中间值</span></span><br><span class="line">	<span class="comment">// 即使再次渲染时看到的仍是初始值，但是会使用中间值进行相应的渲染</span></span><br><span class="line">    <span class="title function_">setIndex</span>(index + <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> sculpture = sculptureList[index];</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;handleClick&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        Next</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">i</span>&gt;</span>&#123;sculpture.name&#125; <span class="tag">&lt;/<span class="name">i</span>&gt;</span> </span></span><br><span class="line"><span class="language-xml">        by &#123;sculpture.artist&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h3</span>&gt;</span>  </span></span><br><span class="line"><span class="language-xml">        (&#123;index + 1&#125; of &#123;sculptureList.length&#125;)</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">img</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">src</span>=<span class="string">&#123;sculpture.url&#125;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">alt</span>=<span class="string">&#123;sculpture.alt&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;sculpture.description&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>Hooks ——以 <code>use</code> 开头的函数——只能在组件或自定义 <code>Hook</code> 的最顶层调用。</strong> 你不能在条件语句、循环语句或其他嵌套函数内调用 <code>Hook</code>。<code>Hook</code> 是函数，但将它们视为关于组件需求的无条件声明会很有帮助。在组件顶部 “use” <code>React</code> 特性，类似于在文件顶部“导入”模块。</p>
<p>React 文档 – <a target="_blank" rel="noopener" href="https://react.docschina.org/learn/state-a-components-memory">state 组件的记忆</a> </p>
</blockquote>
<p>每个组件可以同时定义多个不同的 <code>state</code> ，不会相互影响。但如果发现经常同时更改多个 <code>state</code> 变量，那么可以由一个值为对象的 <code>state</code> 变量的多个字段对应一个 state 变量，在事件处理过程中，通过更改对象的相应字段即可。</p>
<h3 id="State-是隔离且私有的"><a href="#State-是隔离且私有的" class="headerlink" title="State 是隔离且私有的"></a>State 是隔离且私有的</h3><blockquote>
<p>State 是屏幕上组件实例内部的状态。换句话说，<strong>如果你渲染同一个组件两次，每个副本都会有完全隔离的 state</strong>！改变其中一个不会影响另一个。</p>
<p>React 文档 – <a target="_blank" rel="noopener" href="https://react.docschina.org/learn/state-a-components-memory">state 组件的记忆</a> </p>
</blockquote>
<h3 id="渲染和提交"><a href="#渲染和提交" class="headerlink" title="渲染和提交"></a>渲染和提交</h3><p>在 <code>React</code> 中，UI 的更新通常有三个步骤：</p>
<ul>
<li>触发一次渲染<ul>
<li>初次渲染。应用启动时，会触发初次渲染。这个过程通过调用目标 DOM 节点的 <code>createRoot</code>，然后再调用组件调用 <code>render</code> 函数完成。</li>
<li>状态更新时重新渲染。一旦组件被初次渲染，就可以通过使用 <code>setter</code> 函数更新其状态来触发之后的渲染。更新组件的状态会自动将一次渲染送入队列。<br>   set 函数 仅更新 <strong>下一次</strong> 要渲染的状态变量。如果在调用 <code>setter</code> 函数后读取状态变量，则还是会看到之前的旧值；如果提供的新值与当前 <code>state</code> 相同，则不会触发对应组件及子组件的渲染。</li>
</ul>
</li>
<li><code>React</code> 渲染组件<ul>
<li><strong>在进行初次渲染时,</strong> <code>React</code> 会调用根组件。</li>
<li><strong>对于后续的渲染,</strong> <code>React</code> 会调用内部状态更新触发了渲染的函数组件。<br>   这个过程是递归的：如果更新后的组件会返回某个另外的组件，那么 <code>React</code> 接下来就会渲染返回的组件，而如果返回的组件又返回了某个组件，那么 React 接下来就会渲染继续渲染后续返回的组件，以此类推。这个过程会持续下去，直到没有更多的嵌套组件并且 <code>React</code> 确切知道哪些东西应该显示到屏幕上为止。</li>
</ul>
</li>
<li><code>React</code> 把更改提交到 DOM 上<ul>
<li><strong>对于初次渲染，</strong> <code>React</code> 会使用 <code>appendChild()</code> DOM API 将其创建的所有 DOM 节点放在屏幕上。</li>
<li><strong>对于重渲染，</strong> <code>React</code> 将应用最少的必要操作（在渲染时计算。），以使得 DOM 与最新的渲染输出相互匹配。</li>
</ul>
</li>
</ul>
<h3 id="state-的进一步理解"><a href="#state-的进一步理解" class="headerlink" title="state 的进一步理解"></a>state 的进一步理解</h3><p><strong>state 如同一张快照</strong> 是官方对 state 的一个描述。据此，每次状态变化触发渲染时，渲染的结果都是根据上一次渲染后的结果计算得到。因此，即使在事件处理时多次根据状态的值计算的下一次渲染状态，得到的结果都是相同的。例如：</p>
<figure class="highlight javascript"><figcaption><span>根据快照 number 计算下一次渲染的结果</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Counter</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [number, setNumber] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;number&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">        setNumber(number + 1);</span></span><br><span class="line"><span class="language-xml">        setNumber(number + 1);</span></span><br><span class="line"><span class="language-xml">        setNumber(number + 1);</span></span><br><span class="line"><span class="language-xml">      &#125;&#125;&gt;+3<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>上述官方示例中，虽然在按钮的事件处理函数中对 <code>number</code> 状态连续做了三次加一，但是因为都是基于上一次渲染结果的快照（即组件加载时的 0）计算更新，所以最终在下一次渲染时，<code>number</code> 的值为 1，而非 3。另一方面，根据官方文档：</p>
<blockquote>
<p><strong>一个 state 变量的值永远不会在一次渲染的内部发生变化，</strong> 即使其事件处理函数的代码是异步的。</p>
<p>React 文档 – <a target="_blank" rel="noopener" href="https://zh-hans.react.dev/learn/state-as-a-snapshot">state 如同一张快照</a></p>
</blockquote>
<p>在一个新的场景下，如果先对状态进行更新，触发组件重新渲染以后，在直接使用对应的状态（例如弹窗显示等），实际上使用的值是上一次渲染的快照值。</p>
<figure class="highlight javascript"><figcaption><span>渲染组建后随机使用状态做弹窗</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Counter</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [number, setNumber] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;number&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">        setNumber(number + 5);</span></span><br><span class="line"><span class="language-xml">        alert(number);</span></span><br><span class="line"><span class="language-xml">      &#125;&#125;&gt;+5<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="多次更新状态值"><a href="#多次更新状态值" class="headerlink" title="多次更新状态值"></a>多次更新状态值</h3><blockquote>
<p><strong>React 会等到事件处理函数中的</strong> 所有 <strong>代码都运行完毕再处理你的 state 更新。</strong> </p>
<p>React 文档 – <a target="_blank" rel="noopener" href="https://zh-hans.react.dev/learn/queueing-a-series-of-state-updates">把一系列 state 更新加入队列</a></p>
</blockquote>
<p>实际上，事件处理函数及其中任何代码执行完成 之后，UI 才会更新，也就是所谓的批处理，这可以保证渲染结果的正确性。<br>在上一节中的示例中，更新状态值都是基于快照的值进行的，而传递给更新函数的都是计算后的值。有时候需要连续多次的对状态的值进行更新，例如，这种场景下，可以传入一个函数给到设值函数，这样一个更新函数接收相应的参数，用于累积结果：</p>
<figure class="highlight javascript"><figcaption><span>根据更新队列中的值 n，计算后续更新的值</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Counter</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [number, setNumber] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;number&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">        setNumber(number + 5);</span></span><br><span class="line"><span class="language-xml">        setNumber(n =&gt; n + 1);</span></span><br><span class="line"><span class="language-xml">      &#125;&#125;&gt;增加数字<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="更新-state-中的对象及数组"><a href="#更新-state-中的对象及数组" class="headerlink" title="更新 state 中的对象及数组"></a>更新 state 中的对象及数组</h3><p>在 <code>React</code> 中，如果状态对应的是一个对象或者数组，如果单纯相应对象的某个属性发生变化，是不会通知到 React 进行重新渲染的。只有通过设值函数利用修改后的 <strong>新对象</strong> 或者 <strong>新数组</strong> 更新状态，让 <code>React</code> 感知到相应变化，才能触发组件的重新渲染。总体上，把握一个原则， <strong>不要妄想直接改变原有对象触发渲染，不管什么时候，要想React重新渲染组件，就通过复制或者能够返回一个新对象&#x2F;数组的函数，传递一个全新的状态至对应状态的设置函数</strong> 。例如：</p>
<figure class="highlight javascript"><figcaption><span>传递一个新的对象，触发渲染并更新红点位置</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">MovingDot</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [position, setPosition] = <span class="title function_">useState</span>(&#123;</span><br><span class="line">    <span class="attr">x</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">y</span>: <span class="number">0</span></span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">onPointerMove</span>=<span class="string">&#123;e</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">        setPosition(&#123; // 传入一个新的对象</span></span><br><span class="line"><span class="language-xml">          x: e.clientX,</span></span><br><span class="line"><span class="language-xml">          y: e.clientY</span></span><br><span class="line"><span class="language-xml">        &#125;);</span></span><br><span class="line"><span class="language-xml">      &#125;&#125;</span></span><br><span class="line"><span class="language-xml">      style=&#123;&#123;</span></span><br><span class="line"><span class="language-xml">        position: &#x27;relative&#x27;,</span></span><br><span class="line"><span class="language-xml">        width: &#x27;100vw&#x27;,</span></span><br><span class="line"><span class="language-xml">        height: &#x27;100vh&#x27;,</span></span><br><span class="line"><span class="language-xml">      &#125;&#125;&gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">position:</span> &#x27;<span class="attr">absolute</span>&#x27;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">backgroundColor:</span> &#x27;<span class="attr">red</span>&#x27;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">borderRadius:</span> &#x27;<span class="attr">50</span>%&#x27;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">transform:</span> `<span class="attr">translate</span>($&#123;<span class="attr">position.x</span>&#125;<span class="attr">px</span>, $&#123;<span class="attr">position.y</span>&#125;<span class="attr">px</span>)`,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">left:</span> <span class="attr">-10</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">top:</span> <span class="attr">-10</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">width:</span> <span class="attr">20</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">height:</span> <span class="attr">20</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      &#125;&#125; /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果对象比较复杂，可以使用 <strong>展开语法</strong> 进行对象复制：</p>
<figure class="highlight javascript"><figcaption><span>展开语法复制对象/数组</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 复制对象</span></span><br><span class="line"><span class="title function_">setPerson</span>(&#123;  </span><br><span class="line">...person, <span class="comment">// 复制上一个 person 中的所有字段  </span></span><br><span class="line"><span class="attr">firstName</span>: e.<span class="property">target</span>.<span class="property">value</span> <span class="comment">// 但是覆盖 firstName 字段  </span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 复制数组</span></span><br><span class="line"><span class="title function_">setArtists</span>([</span><br><span class="line">&#123; <span class="attr">id</span>: nextId++, <span class="attr">name</span>: name &#125;,  </span><br><span class="line">...artists <span class="comment">// 将原数组中的元素放在末尾  </span></span><br><span class="line">]);</span><br></pre></td></tr></table></figure>

<p>如果对象比较复杂，数据一些逻辑较为啰嗦，可以利用 <code>Immer</code> 库简化相应的更新操作。添加相应的依赖：</p>
<figure class="highlight json"><figcaption><span>immer 依赖</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;dependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;immer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.7.3&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;react&quot;</span><span class="punctuation">:</span> <span class="string">&quot;latest&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;react-dom&quot;</span><span class="punctuation">:</span> <span class="string">&quot;latest&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;react-scripts&quot;</span><span class="punctuation">:</span> <span class="string">&quot;latest&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;use-immer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.5.1&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="string">&quot;react-scripts start&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="string">&quot;react-scripts build&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;test&quot;</span><span class="punctuation">:</span> <span class="string">&quot;react-scripts test --env=jsdom&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;eject&quot;</span><span class="punctuation">:</span> <span class="string">&quot;react-scripts eject&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;devDependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><code>Immer</code> 使用举例：</p>
<figure class="highlight javascript"><figcaption><span>Immer 用法</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useImmer &#125; <span class="keyword">from</span> <span class="string">&#x27;use-immer&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> initialList = [</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="number">0</span>, <span class="attr">title</span>: <span class="string">&#x27;Big Bellies&#x27;</span>, <span class="attr">seen</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">title</span>: <span class="string">&#x27;Lunar Landscape&#x27;</span>, <span class="attr">seen</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">title</span>: <span class="string">&#x27;Terracotta Army&#x27;</span>, <span class="attr">seen</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">BucketList</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [myList, updateMyList] = <span class="title function_">useImmer</span>(</span><br><span class="line">    initialList</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleToggleMyList</span>(<span class="params">id, nextSeen</span>) &#123;</span><br><span class="line">    <span class="title function_">updateMyList</span>(<span class="function"><span class="params">draft</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> artwork = draft.<span class="title function_">find</span>(<span class="function"><span class="params">a</span> =&gt;</span></span><br><span class="line">        a.<span class="property">id</span> === id</span><br><span class="line">      );</span><br><span class="line">      artwork.<span class="property">seen</span> = nextSeen;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>艺术愿望清单<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span>我想看的艺术清单：<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ItemList</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">artworks</span>=<span class="string">&#123;myList&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onToggle</span>=<span class="string">&#123;handleToggleMyList&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span>你想看的艺术清单：<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ItemList</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">artworks</span>=<span class="string">&#123;yourList&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onToggle</span>=<span class="string">&#123;handleToggleYourList&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line">... </span><br></pre></td></tr></table></figure>
</div><div class="article-licensing box"><div class="licensing-title"><p>React 事件响应及单组件状态处理</p><p><a href="https://jblogs.tech/2024/03/framworks/front_framworks/react/event-response-and-single-comp-state/">https://jblogs.tech/2024/03/framworks/front_framworks/react/event-response-and-single-comp-state/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>Jeill</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2024-03-03</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2024-03-17</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/%E7%AC%94%E8%AE%B0/">笔记</a><a class="link-muted mr-2" rel="tag" href="/tags/React/">React</a><a class="link-muted mr-2" rel="tag" href="/tags/%E5%89%8D%E7%AB%AF/">前端</a><a class="link-muted mr-2" rel="tag" href="/tags/%E6%A1%86%E6%9E%B6/">框架</a><a class="link-muted mr-2" rel="tag" href="/tags/%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6/">前端框架</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2024/03/framworks/front_framworks/react/thinking-in-declarative-ui/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">React UI 中的声明式思维</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2024/03/container/docker-repo-oprator/"><span class="level-item">Docker 仓库配置及使用</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">评论</h3><div id="comment-container"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js"></script><script>var gitalk = new Gitalk({
            id: "7b00429d615583902e9bf25fc35256a7",
            repo: "JeillZhang.github.io",
            owner: "JeillZhang",
            clientID: "eb53201d155142dc8f9a",
            clientSecret: "d945224d97b8236e825c4ba4294d6029d6b9c122",
            admin: ["JeillZhang"],
            createIssueManually: true,
            distractionFreeMode: false,
            perPage: 20,
            pagerDirection: "last",
            
            
            enableHotKey: true,
            language: "zh-CN",
        })
        gitalk.render('comment-container')</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/img/header.jpg" alt="Jeill"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Jeill</p><p class="is-size-6 is-block">Love today...</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Shanghai</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">15</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">12</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">15</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/JeillZhang" target="_blank" rel="noopener">关注我</a></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">订阅更新</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="订阅"></div></div></form></div></div></div><div class="column-right-shadow is-hidden-widescreen is-sticky"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3 is-sticky"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="level is-mobile" href="#事件响应"><span class="level-left"><span class="level-item">1</span><span class="level-item">事件响应</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#事件处理函数"><span class="level-left"><span class="level-item">1.1</span><span class="level-item">事件处理函数</span></span></a></li><li><a class="level is-mobile" href="#通过-props-传递事件处理函数"><span class="level-left"><span class="level-item">1.2</span><span class="level-item">通过 props 传递事件处理函数</span></span></a></li><li><a class="level is-mobile" href="#事件传播行为"><span class="level-left"><span class="level-item">1.3</span><span class="level-item">事件传播行为</span></span></a></li><li><a class="level is-mobile" href="#阻止组件默认行为"><span class="level-left"><span class="level-item">1.4</span><span class="level-item">阻止组件默认行为</span></span></a></li></ul></li><li><a class="level is-mobile" href="#State"><span class="level-left"><span class="level-item">2</span><span class="level-item">State</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#添加一个-state-变量"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">添加一个 state 变量</span></span></a></li><li><a class="level is-mobile" href="#State-是隔离且私有的"><span class="level-left"><span class="level-item">2.2</span><span class="level-item">State 是隔离且私有的</span></span></a></li><li><a class="level is-mobile" href="#渲染和提交"><span class="level-left"><span class="level-item">2.3</span><span class="level-item">渲染和提交</span></span></a></li><li><a class="level is-mobile" href="#state-的进一步理解"><span class="level-left"><span class="level-item">2.4</span><span class="level-item">state 的进一步理解</span></span></a></li><li><a class="level is-mobile" href="#多次更新状态值"><span class="level-left"><span class="level-item">2.5</span><span class="level-item">多次更新状态值</span></span></a></li><li><a class="level is-mobile" href="#更新-state-中的对象及数组"><span class="level-left"><span class="level-item">2.6</span><span class="level-item">更新 state 中的对象及数组</span></span></a></li></ul></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/header.jpg" alt="jblogs" height="28"></a><p class="is-size-7"><span>&copy; 2024 Jeill</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a> &amp; <a href="https://gitee.com/JeillZhang" target="_blank" rel="noopener">Jeill(Personalized)</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-cn");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>